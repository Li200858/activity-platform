# ğŸ’° æ”¯ä»˜çŠ¶æ€è®°å½•æœºåˆ¶è¯´æ˜

## ğŸ“Š æ”¯ä»˜çŠ¶æ€å­—æ®µ

åœ¨ `ActivityRegistration`ï¼ˆæ´»åŠ¨æŠ¥åï¼‰æ¨¡å‹ä¸­ï¼Œæœ‰ä¸€ä¸ª `paymentStatus` å­—æ®µï¼Œç”¨äºè®°å½•æ”¯ä»˜çŠ¶æ€ï¼š

```javascript
paymentStatus: {
  type: String,
  enum: ['unpaid', 'paid', 'pending_verification'],
  default: 'unpaid'
}
```

### ä¸‰ç§çŠ¶æ€ï¼š

1. **`unpaid`** - æœªæ”¯ä»˜
   - æ´»åŠ¨æœ‰è´¹ç”¨ä½†ç”¨æˆ·æœªä¸Šä¼ æ”¯ä»˜å‡­è¯
   - æˆ–æ´»åŠ¨æ²¡æœ‰è´¹ç”¨

2. **`pending_verification`** - å¾…å®¡æ ¸
   - ç”¨æˆ·å·²ä¸Šä¼ æ”¯ä»˜æˆªå›¾
   - ç­‰å¾…åˆ›å»ºè€…å®¡æ ¸æ”¯ä»˜å‡­è¯

3. **`paid`** - å·²æ”¯ä»˜
   - åˆ›å»ºè€…å®¡æ ¸é€šè¿‡æŠ¥åç”³è¯·
   - ç³»ç»Ÿè‡ªåŠ¨å°†çŠ¶æ€æ›´æ–°ä¸º"å·²æ”¯ä»˜"

---

## ğŸ”„ æ”¯ä»˜çŠ¶æ€æµè½¬è¿‡ç¨‹

### 1. ç”¨æˆ·æŠ¥åæ—¶ï¼ˆ`/api/activities/register`ï¼‰

```javascript
// å¦‚æœæ´»åŠ¨æœ‰è´¹ç”¨
if (activity.hasFee) {
  if (ä¸Šä¼ äº†æ”¯ä»˜å‡­è¯) {
    paymentStatus = 'pending_verification'  // å¾…å®¡æ ¸
  } else {
    paymentStatus = 'unpaid'  // æœªæ”¯ä»˜ï¼ˆä¼šæŠ¥é”™ï¼Œä¸å…è®¸æäº¤ï¼‰
  }
} else {
  paymentStatus = 'unpaid'  // æ´»åŠ¨æ²¡æœ‰è´¹ç”¨
}
```

**ä»£ç ä½ç½®**ï¼š`server/index.js` ç¬¬ 373 è¡Œ

---

### 2. åˆ›å»ºè€…å®¡æ ¸æ—¶ï¼ˆ`/api/audit/approve`ï¼‰

```javascript
// å½“å®¡æ ¸é€šè¿‡æ—¶
if (status === 'approved') {
  if (activity.hasFee && item.paymentProof) {
    paymentStatus = 'paid'  // å®¡æ ¸é€šè¿‡ï¼Œæ ‡è®°ä¸ºå·²æ”¯ä»˜
  }
}
// å½“å®¡æ ¸æ‹’ç»æ—¶ï¼ŒpaymentStatus ä¿æŒä¸å˜
```

**ä»£ç ä½ç½®**ï¼š`server/index.js` ç¬¬ 617-640 è¡Œ

---

## ğŸ“ å®Œæ•´æµç¨‹ç¤ºä¾‹

### åœºæ™¯ï¼šç”¨æˆ·æŠ¥åä¸€ä¸ªéœ€è¦ä»˜è´¹çš„æ´»åŠ¨

1. **ç”¨æˆ·æäº¤æŠ¥å**
   - ä¸Šä¼ æ”¯ä»˜æˆªå›¾
   - `paymentStatus` = `'pending_verification'` âœ…
   - `status` = `'pending'`ï¼ˆæŠ¥åçŠ¶æ€ï¼šå¾…å®¡æ ¸ï¼‰

2. **åˆ›å»ºè€…æŸ¥çœ‹ç”³è¯·**
   - åœ¨å®¡æ ¸é¡µé¢çœ‹åˆ°"å·²ä¸Šä¼ æ”¯ä»˜å‡­è¯"
   - ç‚¹å‡»æŸ¥çœ‹æ”¯ä»˜æˆªå›¾
   - éªŒè¯æ”¯ä»˜æ˜¯å¦æ­£ç¡®

3. **åˆ›å»ºè€…å®¡æ ¸é€šè¿‡**
   - ç‚¹å‡»"é€šè¿‡"æŒ‰é’®
   - ç³»ç»Ÿè‡ªåŠ¨æ›´æ–°ï¼š
     - `status` = `'approved'`ï¼ˆæŠ¥åçŠ¶æ€ï¼šå·²é€šè¿‡ï¼‰
     - `paymentStatus` = `'paid'`ï¼ˆæ”¯ä»˜çŠ¶æ€ï¼šå·²æ”¯ä»˜ï¼‰âœ…

4. **åˆ›å»ºè€…å®¡æ ¸æ‹’ç»**
   - ç‚¹å‡»"æ‹’ç»"æŒ‰é’®
   - ç³»ç»Ÿæ›´æ–°ï¼š
     - `status` = `'rejected'`ï¼ˆæŠ¥åçŠ¶æ€ï¼šå·²æ‹’ç»ï¼‰
     - `paymentStatus` = ä¿æŒä¸å˜ï¼ˆä»ç„¶æ˜¯ `'pending_verification'`ï¼‰

---

## ğŸ” å¦‚ä½•æŸ¥çœ‹æ”¯ä»˜çŠ¶æ€

### 1. åœ¨å®¡æ ¸é¡µé¢
- æ˜¾ç¤ºåœ¨æŠ¥åç”³è¯·åˆ—è¡¨ä¸­
- æ˜¾ç¤ºåœ¨è¯¦æƒ…æ¨¡æ€æ¡†ä¸­

### 2. åœ¨å‚ä¸è€…åˆ—è¡¨
- æ˜¾ç¤ºæ”¯ä»˜å‡­è¯åˆ—
- å¯ä»¥æŸ¥çœ‹æ”¯ä»˜æˆªå›¾

### 3. åœ¨æ•°æ®åº“æŸ¥è¯¢
```javascript
// æŸ¥è¯¢æ‰€æœ‰å·²æ”¯ä»˜çš„æŠ¥å
ActivityRegistration.find({ 
  paymentStatus: 'paid',
  status: 'approved'
})

// æŸ¥è¯¢å¾…å®¡æ ¸æ”¯ä»˜çš„æŠ¥å
ActivityRegistration.find({ 
  paymentStatus: 'pending_verification',
  status: 'pending'
})
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ”¯ä»˜çŠ¶æ€æ˜¯è‡ªåŠ¨æ›´æ–°çš„**
   - ç”¨æˆ·ä¸Šä¼ æ”¯ä»˜å‡­è¯å â†’ `pending_verification`
   - åˆ›å»ºè€…å®¡æ ¸é€šè¿‡å â†’ `paid`
   - ä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®

2. **æ”¯ä»˜çŠ¶æ€ä¸æŠ¥åçŠ¶æ€æ˜¯åˆ†å¼€çš„**
   - `status`ï¼šæŠ¥åçŠ¶æ€ï¼ˆpending/approved/rejectedï¼‰
   - `paymentStatus`ï¼šæ”¯ä»˜çŠ¶æ€ï¼ˆunpaid/pending_verification/paidï¼‰

3. **åªæœ‰å®¡æ ¸é€šè¿‡æ‰ä¼šæ ‡è®°ä¸ºå·²æ”¯ä»˜**
   - å¦‚æœåˆ›å»ºè€…æ‹’ç»ç”³è¯·ï¼Œæ”¯ä»˜çŠ¶æ€ä¸ä¼šæ›´æ–°
   - è¿™æ ·å¯ä»¥ä¿ç•™è®°å½•ï¼Œæ–¹ä¾¿åç»­å¤„ç†

---

## ğŸ’¡ æ€»ç»“

**ç³»ç»Ÿè®°å½•æ”¯ä»˜çŠ¶æ€çš„æ–¹å¼ï¼š**

1. âœ… **æŠ¥åæ—¶**ï¼šæ ¹æ®æ˜¯å¦ä¸Šä¼ æ”¯ä»˜å‡­è¯ï¼Œè®¾ç½®ä¸º `unpaid` æˆ– `pending_verification`
2. âœ… **å®¡æ ¸é€šè¿‡æ—¶**ï¼šè‡ªåŠ¨æ›´æ–°ä¸º `paid`
3. âœ… **å®¡æ ¸æ‹’ç»æ—¶**ï¼šä¿æŒåŸçŠ¶æ€ä¸å˜

**æ‰€æœ‰çŠ¶æ€éƒ½ä¿å­˜åœ¨æ•°æ®åº“ä¸­**ï¼Œå¯ä»¥éšæ—¶æŸ¥è¯¢å’Œç»Ÿè®¡ã€‚



